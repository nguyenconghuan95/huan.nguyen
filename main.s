        AREA  main, CODE, READONLY
        GLOBAL main_asm

DMAC_BASE     EQU 0XF0100000

DMAC_N0SA_0   EQU (DMAC_BASE + 0x0000)
DMAC_N0DA_0   EQU (DMAC_BASE + 0x0004)
DMAC_N0TB_0   EQU (DMAC_BASE + 0x0008)
DMAC_N1SA_0   EQU (DMAC_BASE + 0x000C)
DMAC_N1DA_0   EQU (DMAC_BASE + 0x0010)
DMAC_N1TB_0   EQU (DMAC_BASE + 0x0014)
DMAC_CRSA_0   EQU (DMAC_BASE + 0x0018)
DMAC_CRDA_0   EQU (DMAC_BASE + 0x001C)
DMAC_CRTB_0   EQU (DMAC_BASE + 0x0020)
DMAC_CHSTAT_0 EQU (DMAC_BASE + 0x0024)
DMAC_CHCTRL_0 EQU (DMAC_BASE + 0x0028)
DMAC_CHCFG_0  EQU (DMAC_BASE + 0x002C)
DMAC_CHITVL_0 EQU (DMAC_BASE + 0x0030)
DMAC_CHEXT_0  EQU (DMAC_BASE + 0x0034)
DMAC_NXLA_0   EQU (DMAC_BASE + 0x0038)
DMAC_CRLA_0   EQU (DMAC_BASE + 0x003C)

DMAC_N0SA_1   EQU (DMAC_BASE + 0x0040)
DMAC_N0DA_1   EQU (DMAC_BASE + 0x0044)
DMAC_N0TB_1   EQU (DMAC_BASE + 0x0048)
DMAC_N1SA_1   EQU (DMAC_BASE + 0x004C)
DMAC_N1DA_1   EQU (DMAC_BASE + 0x0050)
DMAC_N1TB_1   EQU (DMAC_BASE + 0x0054)
DMAC_CRSA_1   EQU (DMAC_BASE + 0x0058)
DMAC_CRDA_1   EQU (DMAC_BASE + 0x005C)
DMAC_CRTB_1   EQU (DMAC_BASE + 0x0060)
DMAC_CHSTAT_1 EQU (DMAC_BASE + 0x0064)
DMAC_CHCTRL_1 EQU (DMAC_BASE + 0x0068)
DMAC_CHCFG_1  EQU (DMAC_BASE + 0x006C)
DMAC_CHITVL_1 EQU (DMAC_BASE + 0x0070)
DMAC_CHEXT_1  EQU (DMAC_BASE + 0x0074)
DMAC_NXLA_1   EQU (DMAC_BASE + 0x0078)
DMAC_CRLA_1   EQU (DMAC_BASE + 0x007C)

DMAC_N0SA_2   EQU (DMAC_BASE + 0x0080)
DMAC_N0DA_2   EQU (DMAC_BASE + 0x0084)
DMAC_N0TB_2   EQU (DMAC_BASE + 0x0088)
DMAC_N1SA_2   EQU (DMAC_BASE + 0x008C)
DMAC_N1DA_2   EQU (DMAC_BASE + 0x0090)
DMAC_N1TB_2   EQU (DMAC_BASE + 0x0094)
DMAC_CRSA_2   EQU (DMAC_BASE + 0x0098)
DMAC_CRDA_2   EQU (DMAC_BASE + 0x009C)
DMAC_CRTB_2   EQU (DMAC_BASE + 0x00A0)
DMAC_CHSTAT_2 EQU (DMAC_BASE + 0x00A4)
DMAC_CHCTRL_2 EQU (DMAC_BASE + 0x00A8)
DMAC_CHCFG_2  EQU (DMAC_BASE + 0x00AC)
DMAC_CHITVL_2 EQU (DMAC_BASE + 0x00B0)
DMAC_CHEXT_2  EQU (DMAC_BASE + 0x00B4)
DMAC_NXLA_2   EQU (DMAC_BASE + 0x00B8)
DMAC_CRLA_2   EQU (DMAC_BASE + 0x00BC)

DMAC_N0SA_3   EQU (DMAC_BASE + 0x00C0)
DMAC_N0DA_3   EQU (DMAC_BASE + 0x00C4)
DMAC_N0TB_3   EQU (DMAC_BASE + 0x00C8)
DMAC_N1SA_3   EQU (DMAC_BASE + 0x00CC)
DMAC_N1DA_3   EQU (DMAC_BASE + 0x00D0)
DMAC_N1TB_3   EQU (DMAC_BASE + 0x00D4)
DMAC_CRSA_3   EQU (DMAC_BASE + 0x00D8)
DMAC_CRDA_3   EQU (DMAC_BASE + 0x00DC)
DMAC_CRTB_3   EQU (DMAC_BASE + 0x00E0)
DMAC_CHSTAT_3 EQU (DMAC_BASE + 0x00E4)
DMAC_CHCTRL_3 EQU (DMAC_BASE + 0x00E8)
DMAC_CHCFG_3  EQU (DMAC_BASE + 0x00EC)
DMAC_CHITVL_3 EQU (DMAC_BASE + 0x00F0)
DMAC_CHEXT_3  EQU (DMAC_BASE + 0x00F4)
DMAC_NXLA_3   EQU (DMAC_BASE + 0x00F8)
DMAC_CRLA_3   EQU (DMAC_BASE + 0x00FC)

DMAC_DCTRL    EQU (DMAC_BASE + 0x0300)
DMAC_DST_EN   EQU (DMAC_BASE + 0x0310)
DMAC_DST_DR   EQU (DMAC_BASE + 0x0314)
DMAC_DST_END  EQU (DMAC_BASE + 0x0318)
DMAC_DST_TC   EQU (DMAC_BASE + 0x031C)
DMAC_DST_SUS  EQU (DMAC_BASE + 0x0320)

MEM_BASE      EQU 0x00000000
SRAM_BASE     EQU 0xF0000000
GIC_BASE      EQU 0xF0120000
GIC_DIST_BASE EQU (GIC_BASE + 0x1000)
GIC_CPU_BASE  EQU (GIC_BASE + 0x2000)

SOURCE        EQU MEM_BASE 
DESTINATION   EQU (SRAM_BASE + 0x0400)
BYTE_COUNT    EQU 0x00000040
  
  macro
  cwrite $addr, $ofs, $val
  ldr   r0,=$addr
  ldr   r1,=$ofs
  ldr   r2,=$val
  str   r2,[r0,r1]
  mend

main_asm
  ;GIC configuration
  ;cwrite  GIC_DIST_BASE, 0x0104, 0x00000002  ;; Interrupt set enable ID 37
  ;cwrite  GIC_DIST_BASE, 0x0824, 0x00000100  ;; Interrupt proccessor target CPU0 ID 37 (just have 1 CPU so CPU interface 0)
  ;cwrite  GIC_CPU_BASE,  0x0004, 0x000000FF  ;; Interrupt priority mask register to all value
  ;cwrite  GIC_CPU_BASE,  0x0000, 0x00000001  ;; CPU Interface control register
  ;cwrite  GIC_DIST_BASE, 0x0000, 0x00000001  ;; Distributor control register enable forwarding group 0 pending interrupt to CPU
  ;cwrite  GIC_CPU_BASE,  0x0000, 0x00000009  ;; FIQEn


  ;DMAC configuration
  cwrite  DMAC_N1SA_0,   0x0000, SOURCE
  cwrite  DMAC_N1DA_0,   0x0000, DESTINATION
  cwrite  DMAC_N0TB_0,   0x0000, BYTE_COUNT
  cwrite  DMAC_CHCFG_0,  0x0000, 0x10022023
  cwrite  DMAC_CHITVL_0, 0x0000, 0x00000000
  cwrite  DMAC_CHEXT_0,  0x0000, 0x00000000
  cwrite  DMAC_CHCTRL_0, 0x0000, 0x00000008
  cwrite  DMAC_CHCTRL_0, 0x0000, 0x00000005
 
loop  
  ldr r3,=DMAC_DST_END
  ldr r5,[r3]
  cmp r5,#0x1
  bne loop
exit
  
